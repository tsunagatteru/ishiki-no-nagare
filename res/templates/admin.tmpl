<!DOCTYPE html>
<html>
<head>
  <title>Admin</title>
</head>
<body>
  <form id="login-form" style="display: none;">
  <div>
    <label for="username">Username</label>
    <input name="username" id="username-input" />
    <label for="password">Password</label>
    <input name="password" id="password-input" type="password" />
  </div>
  <div>
    <button type="submit" onclick="return submitLogin()">Login</button>
  </div>
</form>
<form id="logout-form" style="display: none;">
  <div>
  </div>
  <div>
    <button type="submit" onclick="return submitLogout()">Logout</button>
  </div>
</form>
<form id="post-form" style="display: none;">
  <div>
    <label for="message">What do you want to say?</label>
    <input name="message" id="message-input" />
  </div>
  <div>
    <button type="submit" onclick="return submitPost()">Submit Post</button>
  </div>
</form>
<script>
function submitPost() {
  const form = document.getElementById('post-form');
  const messageInput = document.getElementById('message-input');
  const message = messageInput.value;

  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 201) {
        alert(xhr.responseText);
      } else {
        alert('Error: ' + xhr.status);
      }
    }
  };
  xhr.open('POST', '/api/admin/create-post');
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('message=' + encodeURIComponent(message));

  return false;
}
</script>
<script>
function submitLogout() {
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 200) {
        location.reload();
      } else {
        alert('Error: ' + xhr.status);
      }
    }
  };
  xhr.open('POST', '/api/logout');
  xhr.send();

  return false;
}
</script>
<script>
function submitLogin() {
  const form = document.getElementById('login-form');
  const usernameInput = document.getElementById('username-input');
  const passwordInput = document.getElementById('password-input');
  const username = usernameInput.value;
  const password = passwordInput.value;

  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 200) {
        location.reload();
      } else {
        alert('Error: ' + xhr.status);
      }
    }
  };
  xhr.open('POST', '/api/login');
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('username=' + encodeURIComponent(username) + '&password=' + encodeURIComponent(password));

  return false;
}
</script>
<script>
fetch('/api/admin/status')
  .then(response => {
    if (response.status === 200) {
      document.getElementById('logout-form').style.display = 'block';
      document.getElementById('post-form').style.display = 'block';
    } else if (response.status === 401) {
      document.getElementById('login-form').style.display = 'block';
    }
  })
  .catch(error => {
    console.error('Error fetching admin status:', error);
  });
</script>
</body>
</html>
